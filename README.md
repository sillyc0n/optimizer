# Optimizer
WARNING: The information and tools provided in this repository are for educational purposes only. Investing in financial markets involves significant risks. Past performance does not guarantee future results. Always conduct thorough research and consider consulting with a financial advisor before making investment decisions. Use the information and tools at your own risk.

## Description
Query hl.co.uk funds and optimize your portfolio.

## Installation
Follow steps below to set up the project with Poetry:

1. Install Poetry: `curl -sSL https://install.python-poetry.org | python3 -
2. Navigate to project directory
3. Install dependencies: `poetry install`
4. Start virtual environment `poetry shell`
5. Run each step manually: `python step[01-04].py <arguments>`. See below for argument details.

## Running
### Step01 - Download HL data
Downloads funds data by sending HTTP requests to the API, retrieving fund information in chunks. The script writes this data to a CSV file.

Start with `python step01_download_hl.py output/hl.csv`

### Step02 - Download risk ratings
It reads the CSV file generated by step01, processes each fund's SEDOL, and extracts risk rating data from the Fidelity website. The extracted data is appended to the original CSV file, adding columns for various risk measures and fund information.

Start with `python step02_fidelity_risk_ratings.py output/hl.csv`

### Step03 - Download quotes
Downloads funds quotes. It reads the input CSV file, retrieves historical price data for each fund's Yahoo Finance symbol, and saves the quotes to separate JSON files.

Start with `python step03_yahoo.py output/hl.csv output/quotes`

### Step04
Calculates the correlation matrix. It reads the JSON files created in step03, extracts adjusted close prices, and combines them into a single DataFrame. Then, it computes the correlation matrix based on these price data, saving the result to a CSV file.

Start with `python step04_calculate_correlation_matrix.py output/quotes output/cm.csv`

### Step05
TBD

# Queries
SQL queries allow to identify historically top-performing funds across various criteria. They can find funds with high Sharpe ratios, strong income potential, and low charges. 
Select based on criteria below or write your own to reflect your investment strategy.

## Select top performers by various criteria
### Top 15 funds with annual charge < 0.5 ordered by one-year Sharpe ratio
python query_by_sql.py output/hl.csv output/cm.csv 'SELECT sedol, citicode, full_description, annual_charge, Wealth150, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv
WHERE annual_charge < 0.5 ORDER BY fidelity_sharpeRatios_oneYear DESC LIMIT 15'

### Top 15 Wealth150 funds with annual charge < 0.5 ordered by one-year Sharpe ratio
python query_by_sql.py output/hl.csv output/cm.csv 'SELECT sedol, citicode, full_description, annual_charge, Wealth150, distribution_yield, underlying_yield, gross_yield, gross_running_yield, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv
WHERE annual_charge < 0.5 and Wealth150=1 ORDER BY fidelity_sharpeRatios_oneYear DESC LIMIT 15'

### Top 15 Wealth150 funds with annual charge < 0.5 ordered by distribution yield
python query_by_sql.py output/hl.csv output/cm.csv 'SELECT sedol, citicode, full_description, annual_charge, Wealth150, distribution_yield, underlying_yield, gross_yield, gross_running_yield, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv WHERE annual_charge < 0.5 and Wealth150=1 ORDER BY distribution_yield DESC LIMIT 15'

### Top 15 funds with annual charge < 0.5 ordered by running_yield
python query_by_sql.py output/hl.csv output/cm.csv 'SELECT sedol, citicode, full_description, annual_charge, Wealth150, distribution_yield, underlying_yield, gross_yield, gross_running_yield, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv WHERE annual_charge < 0.5 ORDER BY running_yield DESC LIMIT 15'

### Top 15 Income funds with annual_charge < 0.5 ordered by running_yield
python query_by_sql.py output/hl.csv output/cm.csv "SELECT sedol, citicode, full_description, annual_charge, Wealth150, distribution_yield, underlying_yield, gross_yield, gross_running_yield, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv WHERE annual_charge < 0.5 and unit_type='Income' ORDER BY running_yield DESC LIMIT 15"

### Top 15 Wealth150 funds ordered by fidelity_sharpeRatios_oneYear
python query_by_sql.py output/hl.csv output/cm.csv "SELECT sedol, citicode, full_description, annual_charge, Wealth150, distribution_yield, underlying_yield, gross_yield, gross_running_yield, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv WHERE Wealth150=1 ORDER BY fidelity_sharpeRatios_oneYear DESC LIMIT 15"

### Top 15 Wealth150 funds ordered by gross_running_yield
python query_by_sql.py output/hl.csv output/cm.csv "SELECT sedol, citicode, full_description, annual_charge, Wealth150, distribution_yield, underlying_yield, gross_yield, gross_running_yield, fidelity_sharpeRatios_oneYear, fidelity_sharpeRatios_threeYear FROM hl_csv WHERE Wealth150=1 ORDER BY gross_running_yield DESC LIMIT 15"

### Print sedols on one line
python query_by_sql.py output/hl.csv output/cm.csv "SELECT sedol FROM hl_csv WHERE unit_type='Income' and fidelity_sharpeRatios_oneYear>0 ORDER BY distribution_yield - annual_charge DESC LIMIT 25" | awk 'NR>1 {printf "%s ", $2} END {print ""}'

## License
See [LICENSE.md](LICENSE.md) for license information.

# TODO
Finish optimization step